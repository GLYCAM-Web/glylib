<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GLYLIB: inc/AMBER/read_prep.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="../../dir_000000.html">inc</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000001.html">AMBER</a></div>
<h1>read_prep.h File Reference</h1>
<p>
This graph shows which files directly or indirectly include this file:<p><center><img src="../../d9/dfa/read__prep_8h__dep__incl.png" border="0" usemap="#read_prep.hdep_map" alt="Included by dependency graph"></center>
<map name="read_prep.hdep_map">
<area href="../../d3/dcd/amber_8h.html" shape="rect" coords="5,5,75,32" alt="">
<area href="../../da/d0c/read__prep_8c.html" shape="rect" coords="99,5,189,32" alt="">
</map>

<p>
<a href="../../dc/db8/read__prep_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d65/read__prep_8h.html#a0">read_prep</a> (<a class="el" href="../../dc/d7f/structmolecule.html">molecule</a> *M, <a class="el" href="../../dc/d59/structfileset.html">fileset</a> F, <a class="el" href="../../d5/de2/structtypes.html">types</a> *TYP)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d0/d7e/structresidue.html">residue</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d65/read__prep_8h.html#a1">read_prepres</a> (<a class="el" href="../../dc/d59/structfileset.html">fileset</a> F, <a class="el" href="../../d5/de2/structtypes.html">types</a> *TYP)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../da/d81/structatom.html">atom</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d65/read__prep_8h.html#a2">read_prepatom</a> (const char *<a class="el" href="../../d7/d40/load__pdb_8h.html#a4">line</a>, <a class="el" href="../../d5/de2/structtypes.html">types</a> *TYP)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="read_prep.h::read_prep"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void read_prep           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dc/d7f/structmolecule.html">molecule</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>M</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../dc/d59/structfileset.html">fileset</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>F</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/de2/structtypes.html">types</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>TYP</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../de/d85/read__prep_8c-source.html#l00041">41</a> of file <a class="el" href="../../de/d85/read__prep_8c-source.html">read_prep.c</a>.
<p>
References <a class="el" href="../../d5/d31/general_8h-source.html#l00028">fileset::F</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00011">ambermprepinfo::FN</a>, <a class="el" href="../../d7/d04/load__pdb_8h-source.html#l00021">line</a>, <a class="el" href="../../d9/dc2/myfopen_8c-source.html#l00025">myfreopen()</a>, <a class="el" href="../../d7/d30/mywhine_8c-source.html#l00007">mywhine()</a>, <a class="el" href="../../d5/d31/general_8h-source.html#l00027">fileset::N</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00012">ambermprepinfo::NAMDBF</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00212">molecule::nr</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00230">molecule::nVP</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00213">molecule::r</a>, <a class="el" href="../../de/d85/read__prep_8c-source.html#l00097">read_prepres()</a>, and <a class="el" href="../../da/dff/molecules_8h-source.html#l00231">molecule::VP</a>.<div class="fragment"><pre class="fragment">00041                                                   {
00042 <span class="keywordtype">int</span> rpa=0,stopflag=1,rpuse=0,rpsz=0,rpbins=0;
00043 <span class="keywordtype">char</span> <a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[501];
00044 <a class="code" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a> *amp;
00045 fpos_t f_linestart;
00046 
00047 M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo30">nVP</a>=1;
00048 amp=(<a class="code" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a>));
00049 F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>=<a class="code" href="../../de/de6/myfopen_8c.html#a1">myfreopen</a>(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>,<span class="stringliteral">"r"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// don't depend on calling function to have opened</span>
00050 amp[0].<a class="code" href="../../d3/dc4/structambermprepinfo.html#ambermprepinfoo0">FN</a>=strdup(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00051 fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00052 sscanf(line,<span class="stringliteral">"%d %d %d"</span>,&amp;amp[0].IDBGEN,&amp;amp[0].IREST,&amp;amp[0].ITYPF);
00053 fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00054 amp[0].<a class="code" href="../../d3/dc4/structambermprepinfo.html#ambermprepinfoo1">NAMDBF</a>=strdup(line);
00055 M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo31">VP</a>=amp;
00056 
00057 rpuse=malloc_usable_size(M[0].r);
00058 rpsz=<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d7e/structresidue.html">residue</a>);
00059 rpbins=rpuse/rpsz;
00060 <span class="keywordflow">if</span>(rpbins&lt;1){<a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(<span class="stringliteral">"read_prep: no space in residue -- is molecule not initialized?"</span>);}
00061 
00062 <span class="comment">//printf("about to read through the file. Current line is\n\t&gt;&gt;%s&lt;&lt;\n",line);</span>
00063 fgetpos(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>,&amp;f_linestart);<span class="comment">// get current position</span>
00064 <span class="keywordflow">while</span>(fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){<span class="comment">// while not end of file</span>
00065 <span class="comment">//printf("\treading a line ...  line is\n&gt;&gt;%s&lt;&lt;\n",line);</span>
00066         stopflag=1;
00067         <span class="keywordflow">for</span>(rpa=0;rpa&lt;strlen(line);rpa++){<span class="comment">// if the first word is not "STOP" (and only that??)</span>
00068                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rpa]!=<span class="charliteral">'\t'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rpa]!=<span class="charliteral">' '</span>)){
00069 <span class="comment">//printf("rpa is %d and line[rpa] is &gt;&gt;%c&lt;&lt; and strlen(line) is %d\n",rpa,line[rpa],strlen(line));</span>
00070                         <span class="keywordflow">if</span>(rpa+4&gt;strlen(line)){<span class="keywordflow">break</span>;}
00071                         <span class="keywordflow">else</span>{ 
00072                                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rpa]==<span class="charliteral">'S'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rpa+1]==<span class="charliteral">'T'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rpa+2]==<span class="charliteral">'O'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rpa+3]==<span class="charliteral">'P'</span>)){ 
00073                                         stopflag=0;
00074                                         }
00075                                 <span class="keywordflow">break</span>;
00076                                 }
00077                         }
00078                 }
00079 <span class="comment">//printf("stopflag is %d\n",stopflag);</span>
00080         <span class="keywordflow">if</span>(stopflag==0){<span class="keywordflow">break</span>;} <span class="comment">// break loop</span>
00081 <span class="comment">//printf("about to allocate space for the residue...\n");</span>
00082         M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo11">nr</a>++;<span class="comment">// allocate new memory for a residue</span>
00083         M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo12">r</a>=(<a class="code" href="../../d0/d7e/structresidue.html">residue</a>*)realloc(M[0].r,M[0].nr*<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d7e/structresidue.html">residue</a>));
00084         fsetpos(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>,&amp;f_linestart); <span class="comment">// rewind to start of line</span>
00085         M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo12">r</a>[M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo11">nr</a>-1]=<a class="code" href="../../da/d0c/read__prep_8c.html#a1">read_prepres</a>(F,TYP);<span class="comment">// call read_prepres to read in the residue information</span>
00086         fgetpos(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>,&amp;f_linestart);<span class="comment">// get current position </span>
00087         } <span class="comment">// end while not end of file</span>
00088 <span class="keywordflow">return</span>;
00089 }
</pre></div>
<p>
    </td>
  </tr>
</table>

<p>
Here is the call graph for this function:<p><center><img src="../../d3/d65/read__prep_8h_a0_cgraph.png" border="0" usemap="#d3/d65/read__prep_8h_a0_cgraph_map" alt=""></center>
<map name="d3/d65/read__prep_8h_a0_cgraph_map">
<area href="../../de/de6/myfopen_8c.html#a1" shape="rect" coords="145,5,228,32" alt="">
<area href="../../d9/d66/mywhine_8c.html#a0" shape="rect" coords="447,107,519,133" alt="">
<area href="../../da/d0c/read__prep_8c.html#a1" shape="rect" coords="137,132,236,159" alt="">
<area href="../../d9/dd3/read__eek_8c.html#a0" shape="rect" coords="303,107,380,133" alt="">
<area href="../../da/d0c/read__prep_8c.html#a2" shape="rect" coords="285,157,397,184" alt="">
<area href="../../d3/de6/molecules_8h.html#a59" shape="rect" coords="297,208,385,235" alt="">
</map>
<a class="anchor" name="a2" doxytag="read_prep.h::read_prepatom"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../da/d81/structatom.html">atom</a> read_prepatom           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/de2/structtypes.html">types</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>TYP</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../de/d85/read__prep_8c-source.html#l00235">235</a> of file <a class="el" href="../../de/d85/read__prep_8c-source.html">read_prep.c</a>.
<p>
References <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00030">amberaprepinfo::I</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00031">amberaprepinfo::IGRAPH</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00032">amberaprepinfo::ISYMBL</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00033">amberaprepinfo::ITREE</a>, <a class="el" href="../../d7/d04/load__pdb_8h-source.html#l00021">line</a>, <a class="el" href="../../d7/d30/mywhine_8c-source.html#l00007">mywhine()</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00134">atom::N</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00133">atom::n</a>, <a class="el" href="../../d5/d69/parameter__sets_8h-source.html#l00107">types::na</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00160">atom::nVP</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00135">atom::T</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00137">atom::t</a>, and <a class="el" href="../../da/dff/molecules_8h-source.html#l00161">atom::VP</a>.
<p>
Referenced by <a class="el" href="../../de/d85/read__prep_8c-source.html#l00097">read_prepres()</a>.<div class="fragment"><pre class="fragment">00235                                                 {
00236 <a class="code" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a> *aap;
00237 <a class="code" href="../../da/d81/structatom.html">atom</a> A;
00238 <span class="keywordtype">char</span> N[21],T[21],C[21]; <span class="comment">// if any entry is longer than 21 chars, something is wrong...</span>
00239 <span class="keywordtype">char</span> whinetext[201]; <span class="comment">// error message text</span>
00240 <span class="keywordtype">int</span> raa=0;
00241 
00242 <span class="comment">// Most of this will go into an amberaprepinfo structure.</span>
00243 <span class="comment">// Some bits also go into an atom structure</span>
00244 <span class="comment">// Here is a typical prep-file atom line:</span>
00245 <span class="comment">//      &gt;&gt; 4 C1   CG  M  3  2  1  1.400   113.9      60.0     0.4780&lt;&lt;</span>
00246 <span class="comment">//         1  2   3   4  5  6  7    8      9          10       11</span>
00247 <span class="comment">//      The atom structure bits:</span>
00248 <span class="comment">//      1: A.n</span>
00249 <span class="comment">//      2: A.N=strdup(2)</span>
00250 <span class="comment">//      3: A.T=strdup(3)  --and-- A.t=number for type 3</span>
00251 
00252 aap=(<a class="code" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a>));
00253 
00254 sscanf(line,<span class="stringliteral">"%d %s %s %s %d %d %d %lf %lf %lf %lf"</span>,\
00255         &amp;aap[0].I,N,T,C,&amp;aap[0].NA,&amp;aap[0].NB,&amp;aap[0].NC,&amp;aap[0].R,&amp;aap[0].THETA,&amp;aap[0].PHI,&amp;aap[0].CHG);
00256 A.<a class="code" href="../../da/d81/structatom.html#atomo1">N</a>=strdup(N);
00257 aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo1">IGRAPH</a>=strdup(N);
00258 A.<a class="code" href="../../da/d81/structatom.html#atomo2">T</a>=strdup(T);
00259 aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo2">ISYMBL</a>=strdup(T);
00260 aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo3">ITREE</a>=strdup(C);
00261 A.<a class="code" href="../../da/d81/structatom.html#atomo0">n</a>=aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo0">I</a>-3; 
00262 <span class="comment">// set the atom's type according to the data in TYP</span>
00263 A.<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>=-1;
00264 <span class="keywordflow">for</span>(raa=0;raa&lt;TYP[0].<a class="code" href="../../d5/de2/structtypes.html#typeso0">na</a>;raa++){
00265 <span class="comment">//printf("TYP[0].a[raa].N is &gt;&gt;%s&lt;&lt; ; A.T is &gt;&gt;%s&lt;&lt;\n",TYP[0].a[raa].N,A.T);</span>
00266         <span class="keywordflow">if</span>(strcmp(TYP[0].a[raa].N,A.<a class="code" href="../../da/d81/structatom.html#atomo2">T</a>)==0){ 
00267                 A.<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>=raa; 
00268                 <span class="keywordflow">break</span>;} }
00269 <span class="keywordflow">if</span>(A.<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>==-1){
00270         sprintf(whinetext,<span class="stringliteral">"read_prepatom:\n\tMatch not found for atom type %s.  The prep file line follows:\n\n%s\n\n"</span>,A.<a class="code" href="../../da/d81/structatom.html#atomo2">T</a>,line);
00271         <a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(whinetext);
00272         }
00273 <span class="comment">//printf("The entire line is:\n");</span>
00274 <span class="comment">/*printf("%d %s %s %s %d %d %d %f %f %f %f\n",aap[0].I,aap[0].IGRAPH,aap[0].ISYMBL,\</span>
00275 <span class="comment">        aap[0].ITREE,aap[0].NA,aap[0].NB,aap[0].NC,aap[0].R,aap[0].THETA,aap[0].PHI,aap[0].CHG);*/</span>
00276 <span class="comment">//</span>
00277 A.<a class="code" href="../../da/d81/structatom.html#atomo27">nVP</a>=1;
00278 A.<a class="code" href="../../da/d81/structatom.html#atomo28">VP</a>=aap;
00279 
00280 <span class="keywordflow">return</span> A;
00281 }
</pre></div>
<p>
    </td>
  </tr>
</table>

<p>
Here is the call graph for this function:<p><center><img src="../../d3/d65/read__prep_8h_a2_cgraph.png" border="0" usemap="#d3/d65/read__prep_8h_a2_cgraph_map" alt=""></center>
<map name="d3/d65/read__prep_8h_a2_cgraph_map">
<area href="../../d9/d66/mywhine_8c.html#a0" shape="rect" coords="167,5,239,32" alt="">
</map>
<a class="anchor" name="a1" doxytag="read_prep.h::read_prepres"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d7e/structresidue.html">residue</a> read_prepres           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dc/d59/structfileset.html">fileset</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>F</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/de2/structtypes.html">types</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>TYP</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../de/d85/read__prep_8c-source.html#l00097">97</a> of file <a class="el" href="../../de/d85/read__prep_8c-source.html">read_prep.c</a>.
<p>
References <a class="el" href="../../da/dff/molecules_8h-source.html#l00175">residue::a</a>, <a class="el" href="../../d5/d69/parameter__sets_8h-source.html#l00108">types::a</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00178">residue::bs</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00174">residue::COM</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00190">residue::d</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00168">residue::D</a>, <a class="el" href="../../d5/d31/general_8h-source.html#l00028">fileset::F</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00188">residue::i</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00021">amberrprepinfo::IFIXC</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00019">amberrprepinfo::INTX</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00022">amberrprepinfo::IOMIT</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00027">amberrprepinfo::IOPR</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00024">amberrprepinfo::IPOS</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00023">amberrprepinfo::ISYMDU</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00020">amberrprepinfo::KFORM</a>, <a class="el" href="../../d7/d04/load__pdb_8h-source.html#l00021">line</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00173">residue::m</a>, <a class="el" href="../../d5/d69/parameter__sets_8h-source.html#l00050">atype::m</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00166">residue::n</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00167">residue::N</a>, <a class="el" href="../../d5/d31/general_8h-source.html#l00027">fileset::N</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00172">residue::na</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00017">amberrprepinfo::NAMF</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00018">amberrprepinfo::NAMRES</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00177">residue::nbs</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00189">residue::nd</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00187">residue::ni</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00026">amberrprepinfo::nIOPR</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00195">residue::nVP</a>, <a class="el" href="../../d8/d4d/read__eek_8c-source.html#l00006">read_eek()</a>, <a class="el" href="../../de/d85/read__prep_8c-source.html#l00235">read_prepatom()</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00137">atom::t</a>, <a class="el" href="../../d5/d31/general_8h-source.html#l00010">llcharset::T</a>, <a class="el" href="../../dc/db8/read__prep_8h-source.html#l00016">amberrprepinfo::TITLE</a>, <a class="el" href="../../da/dff/molecules_8h-source.html#l00196">residue::VP</a>, and <a class="el" href="../../da/d80/zero__vec__crd_8c-source.html#l00019">zero_coord()</a>.
<p>
Referenced by <a class="el" href="../../de/d85/read__prep_8c-source.html#l00041">read_prep()</a>.<div class="fragment"><pre class="fragment">00097                                            { <span class="comment">// will the position be what is expected?</span>
00098 <a class="code" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a> *arp;
00099 <a class="code" href="../../d0/d7e/structresidue.html">residue</a> R;
00100 <span class="keywordtype">char</span> <a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[501],desc[1001],ctmp[51],ctmp2[51]; <span class="comment">// hope no prep file line is longer than this...</span>
00101 <span class="keywordtype">char</span> dumat[21]; <span class="comment">// the symbol used for dummy atoms </span>
00102 <span class="keywordtype">char</span> *linestat; <span class="comment">// did the line read work?</span>
00103 <span class="keywordtype">int</span> itmp=0,rra=0,rline=0;
00104 <span class="keywordtype">char</span> whinetext[1001];
00105 
00106 <span class="comment">// initialize R</span>
00107 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo0">n</a>=0; <span class="comment">// residue number given in input file</span>
00108 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo1">N</a>=strdup(<span class="stringliteral">""</span>); <span class="comment">// reside name -- can live with residue names of 200 chars or less???  :-)</span>
00109 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>=0; <span class="comment">// number of atoms in residue</span>
00110 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo7">m</a>=0; <span class="comment">// molecular weight</span>
00111 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo8">COM</a>=<a class="code" href="../../d3/de6/molecules_8h.html#a59">zero_coord</a>(); <span class="comment">// center of mass for residue</span>
00112 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>=(<a class="code" href="../../da/d81/structatom.html">atom</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../da/d81/structatom.html">atom</a>)); <span class="comment">// atom structures (na of these)</span>
00113 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo11">nbs</a>=0; <span class="comment">// number of bond sets</span>
00114 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo12">bs</a>=(<a class="code" href="../../d6/df4/structbondset.html">bondset</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d6/df4/structbondset.html">bondset</a>)); <span class="comment">// (consecutive bonds, use these for plotting, etc.)</span>
00115 <span class="comment">//int nr; // number of simple rings (no cage structures, etc.)</span>
00116 <span class="comment">//int nrbs; // number of ring bondsets defined</span>
00117 <span class="comment">//bondset *rbs; // bondsets for rings</span>
00118 <span class="comment">//int nrc; // number of ring/reference coordinate sets defined</span>
00119 <span class="comment">//coord_3D *rc; // coordinates for ring/reference centers</span>
00120 <span class="comment">//int nrp; // number of ring planes defined</span>
00121 <span class="comment">//plane *rp; // equations for average/approximate/exact/etc. ring planes (where useful)</span>
00122 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo20">ni</a>=1; <span class="comment">// number of other indices</span>
00123 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo21">i</a>=(<span class="keywordtype">int</span>*)calloc(R.<a class="code" href="../../d0/d7e/structresidue.html#residueo20">ni</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)); <span class="comment">// other indices, as needed (ni of these)</span>
00124 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo22">nd</a>=1; <span class="comment">// number of double-precision parameters</span>
00125 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo23">d</a>=(<span class="keywordtype">double</span>*)calloc(R.<a class="code" href="../../d0/d7e/structresidue.html#residueo22">nd</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">// other parameters, as needed (nd of these)</span>
00126 
00127 <span class="comment">// allocate space for prepinfo</span>
00128 arp=(<a class="code" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a>));
00129 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo11">IOPR</a>=(<a class="code" href="../../d9/db0/structllcharset.html">llcharset</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d9/db0/structllcharset.html">llcharset</a>));
00130 
00131 <span class="comment">// Read residue header information into residue structure</span>
00132 <span class="comment">/* A sample header is:</span>
00133 <span class="comment">0-[ALPHA-D-ALLO-] terminal, RESP 0.010 HF/6-31Gstar//HF/6-31Gstar</span>
00134 <span class="comment">0na.dat</span>
00135 <span class="comment">0NA   INT 0</span>
00136 <span class="comment">CORRECT OMIT DU BEG</span>
00137 <span class="comment"> 0.1940</span>
00138 <span class="comment"></span>
00139 <span class="comment">By line, they are:</span>
00140 <span class="comment">1-2] R.D</span>
00141 <span class="comment">3] R.N, error if not INT (for now), error if not zero (for now)</span>
00142 <span class="comment">4] error if not "CORRECT", ignore, read in dummy atom name, ignore</span>
00143 <span class="comment">5] R.d[0]</span>
00144 <span class="comment">*/</span>
00145 <span class="comment">// first two lines (description)</span>
00146 linestat=fgets(desc,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// first line</span>
00147 <span class="comment">//printf("line 1 looks like: &gt;&gt;%s&lt;&lt;\n",desc);</span>
00148 <span class="keywordflow">if</span>(linestat==NULL){<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 1"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00149 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo0">TITLE</a>=strdup(desc); <span class="comment">// add description to arp (destined for void pointer)</span>
00150 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo2">D</a>=strdup(desc); <span class="comment">// copy to residue structure</span>
00151 linestat=fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// second line</span>
00152 <span class="comment">//printf("line 2 looks like: &gt;&gt;%s&lt;&lt;\n",line);</span>
00153 <span class="keywordflow">if</span>(linestat==NULL){<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 2"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00154 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo1">NAMF</a>=strdup(line);
00155 <span class="comment">// next line (name and other)</span>
00156 linestat=fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// third line</span>
00157 <span class="keywordflow">if</span>(linestat==NULL){<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 3"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00158 sscanf(line,<span class="stringliteral">"%s %s %d"</span>,desc,ctmp,&amp;itmp);
00159 <span class="comment">//printf("line 3 looks like: &gt;&gt;%s&lt;&lt;\n",line);</span>
00160 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo1">N</a>=strdup(desc); <span class="comment">// set the residue name</span>
00161 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo2">NAMRES</a>=strdup(desc);
00162 <span class="keywordflow">if</span>(strcmp(ctmp,<span class="stringliteral">"INT"</span>)!=0){<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"entry not INT on line 3 of residue header"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00163 <span class="keywordflow">if</span>(itmp!=0){<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"KFORM not zero on line 3 of residue header"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00164 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo3">INTX</a>=strdup(ctmp);
00165 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo4">KFORM</a>=itmp;
00166 <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00167 linestat=fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00168 <span class="keywordflow">if</span>(linestat==NULL)<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 4"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00169 sscanf(line,<span class="stringliteral">"%s %s %s %s"</span>,desc,ctmp,dumat,ctmp2);
00170 <span class="keywordflow">if</span>(strcmp(desc,<span class="stringliteral">"CORRECT"</span>)!=0){<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"entry not CORRECT on line 4 of residue header"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); }
00171 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo5">IFIXC</a>=strdup(desc);
00172 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo6">IOMIT</a>=strdup(ctmp);
00173 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo7">ISYMDU</a>=strdup(dumat);
00174 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo8">IPOS</a>=strdup(ctmp2);
00175 <span class="comment">// fifth line (charge on residue)</span>
00176 linestat=fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00177 <span class="keywordflow">if</span>(linestat==NULL)<a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 5 (residue charge)"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00178 sscanf(line,<span class="stringliteral">"%lf"</span>,&amp;arp[0].CUT);
00179 <span class="comment">// scan first three dummy atom lines, make sure that the third field</span>
00180 <span class="comment">//      of each is dumat and ignore otherwise (for now, at least)</span>
00181 <span class="keywordflow">for</span>(rra=0;rra&lt;3;rra++){
00182         linestat=fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00183         <span class="keywordflow">if</span>(linestat==NULL){
00184                 sprintf(whinetext,<span class="stringliteral">"EOF during residue header read, dummy atom line %d"</span>,(rra+1));
00185                 <a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(whinetext,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); }
00186         sscanf(line,<span class="stringliteral">"%s %s %s "</span>,desc,ctmp,ctmp2);
00187         <span class="keywordflow">if</span>(strcmp(ctmp2,dumat)!=0){
00188 <span class="comment">//printf("\t dumat is &gt;&gt;%s&lt;&lt;, and line looks like: &gt;&gt;%s&lt;&lt;\n",dumat,line);</span>
00189                 sprintf(whinetext,<span class="stringliteral">"dummy atom symbol, line %d, does not match declared value"</span>,(rra+1));
00190                 <a class="code" href="../../d9/dd3/read__eek_8c.html#a0">read_eek</a>(whinetext,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); }
00191         }
00192 
00193 <span class="keywordflow">while</span>(fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){ <span class="comment">// while not end of file</span>
00194         rline=1;
00195 <span class="comment">//printf("line is: %s\n",line);</span>
00196         <span class="keywordflow">for</span>(rra=0;rra&lt;strlen(line);rra++){ <span class="comment">// check for an empty line</span>
00197                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rra]!=<span class="charliteral">'\t'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rra]!=<span class="charliteral">' '</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rra]!=<span class="charliteral">'\n'</span>)){ <span class="comment">// if this character is NOT a space or tab</span>
00198                         rline=0;
00199                         <span class="keywordflow">break</span>; } }
00200         <span class="keywordflow">if</span>(rline==1) <span class="keywordflow">break</span>;<span class="comment">// if an empty line, break loop</span>
00201 <span class="comment">//printf("calling read atom for line: %s\n",line);</span>
00202         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>++;<span class="comment">//       allocate space</span>
00203         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>=(<a class="code" href="../../da/d81/structatom.html">atom</a>*)realloc(R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>,R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../da/d81/structatom.html">atom</a>));
00204         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>[R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>-1]=<a class="code" href="../../da/d0c/read__prep_8c.html#a2">read_prepatom</a>(line,TYP);<span class="comment">//read_prepatom</span>
00205         <span class="comment">// update molecular weight for residue</span>
00206         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo7">m</a>+=TYP[0].<a class="code" href="../../d5/de2/structtypes.html#typeso1">a</a>[R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>[R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>-1].<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>].<a class="code" href="../../dc/d7a/structatype.html#atypeo3">m</a>;
00207         } <span class="comment">// end read of the residue's atoms</span>
00208 
00209 <span class="comment">// while not "DONE", read any after-atoms residue information</span>
00210 <span class="keywordflow">while</span>(fgets(line,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){ <span class="comment">// while not end of file</span>
00211         rline=1;
00212         <span class="keywordflow">for</span>(rra=0;rra&lt;strlen(line);rra++){ <span class="comment">// check for an empty line</span>
00213                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rra]!=<span class="charliteral">'\t'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[rra]!=<span class="charliteral">' '</span>)){ <span class="comment">// if this character is NOT a space or tab</span>
00214                         rline=0;
00215                         <span class="keywordflow">break</span>; } }
00216         <span class="keywordflow">if</span>(rline==1) <span class="keywordflow">continue</span>;<span class="comment">// if an empty line, check next line </span>
00217         <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[0]==<span class="charliteral">'D'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[1]==<span class="charliteral">'O'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[2]==<span class="charliteral">'N'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a4">line</a>[3]==<span class="charliteral">'E'</span>)){<span class="keywordflow">break</span>;}
00218         arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo10">nIOPR</a>++;
00219         arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo11">IOPR</a>=(<a class="code" href="../../d9/db0/structllcharset.html">llcharset</a>*)realloc(arp[0].IOPR,arp[0].nIOPR*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/db0/structllcharset.html">llcharset</a>));
00220         arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo11">IOPR</a>[arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo10">nIOPR</a>-1].<a class="code" href="../../d9/db0/structllcharset.html#llcharseto0">T</a>=strdup(line);
00221         } <span class="comment">// end scan of post-atom residue info</span>
00222 
00223 <span class="comment">//printf("Residue %s contains %d atoms\n",R.N,R.na);</span>
00224 <span class="comment">// for future:</span>
00225 <span class="comment">//   scan atom info to set bonding</span>
00226 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo28">nVP</a>=1;
00227 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo29">VP</a>=arp;
00228 
00229 <span class="keywordflow">return</span> R;       
00230 }
</pre></div>
<p>
    </td>
  </tr>
</table>

<p>
Here is the call graph for this function:<p><center><img src="../../d3/d65/read__prep_8h_a1_cgraph.png" border="0" usemap="#d3/d65/read__prep_8h_a1_cgraph_map" alt=""></center>
<map name="d3/d65/read__prep_8h_a1_cgraph_map">
<area href="../../d9/dd3/read__eek_8c.html#a0" shape="rect" coords="172,5,249,32" alt="">
<area href="../../da/d0c/read__prep_8c.html#a2" shape="rect" coords="155,56,267,83" alt="">
<area href="../../d3/de6/molecules_8h.html#a59" shape="rect" coords="167,107,255,133" alt="">
<area href="../../d9/d66/mywhine_8c.html#a0" shape="rect" coords="316,56,388,83" alt="">
</map>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jul 21 17:08:03 2008 for GLYLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
