<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GLYLIB: src/read_prep.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="../../dir_000002.html">src</a></div>
<h1>read_prep.c</h1><a href="../../da/d0c/read__prep_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* File read_prep.c begun on 20071120 by BLFoley</span>
00002 <span class="comment"></span>
00003 <span class="comment">Purpose:  Read prep file contents into a molecule structure</span>
00004 <span class="comment"></span>
00005 <span class="comment">NOTE:   At present, this function only reads in the prep file.</span>
00006 <span class="comment">        It will not set bonding, etc., in the main residue.</span>
00007 <span class="comment"></span>
00008 <span class="comment">NOTE:   Much information is read into the void pointer space.</span>
00009 <span class="comment"></span>
00010 <span class="comment">Since prep files are generated on a per-residue basis, each </span>
00011 <span class="comment">entry will be considered part of the molecule structure.</span>
00012 <span class="comment"></span>
00013 <span class="comment">This function will rely on read_prepres, which will read in</span>
00014 <span class="comment">a single residue.  That function will rely on read_prepatom</span>
00015 <span class="comment">as well.  Both read_prepres and read_prepatom will return</span>
00016 <span class="comment">enture residues/atoms.</span>
00017 <span class="comment"></span>
00018 <span class="comment">In order to allow for the addition of many prep files to an</span>
00019 <span class="comment">expanding database of residues, this function will add residues</span>
00020 <span class="comment">to an existing molecule structure (rather than returning a</span>
00021 <span class="comment">new structure).  </span>
00022 <span class="comment"></span>
00023 <span class="comment">NOTE:   THE PARENT MOLECULE STRUCTURE MUST BE PREINITIALIZED</span>
00024 <span class="comment">        THIS INCLUDES AN INITIAL ALLOCATION OF THE RESIDUE</span>
00025 <span class="comment">        SUB STRUCTURES (M.nr should be set to zero if there are</span>
00026 <span class="comment">        no existing residues in the molecule).</span>
00027 <span class="comment">*/</span> 
00028 <span class="preprocessor">#include &lt;<a class="code" href="../../dd/dea/mylib_8h.html">mylib.h</a>&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/de6/molecules_8h.html">molecules.h</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/d14/general_8h.html">general.h</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d65/read__prep_8h.html">AMBER/read_prep.h</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="../../db/d40/declarations_8h.html">declarations.h</a>&gt;</span>
00033 <span class="comment">//#include "../inc/mylib.h"</span>
00034 <span class="comment">//#include "../inc/molecules.h"</span>
00035 <span class="comment">//#include "../inc/general.h"</span>
00036 <span class="comment">//#include "../inc/read_prep.h"</span>
00037 <span class="comment">//#include "../inc/declarations.h"</span>
00038 
00039 
00040 
<a name="l00041"></a><a class="code" href="../../da/d0c/read__prep_8c.html#a0">00041</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d0c/read__prep_8c.html#a0">read_prep</a>(<a class="code" href="../../dc/d7f/structmolecule.html">molecule</a> *M, <a class="code" href="../../dc/d59/structfileset.html">fileset</a> F, <a class="code" href="../../d5/de2/structtypes.html">types</a> *TYP){
00042 <span class="keywordtype">int</span> rpa=0,stopflag=1,rpuse=0,rpsz=0,rpbins=0;
00043 <span class="keywordtype">char</span> <a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[501];
00044 <a class="code" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a> *amp;
00045 fpos_t f_linestart;
00046 
00047 M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo30">nVP</a>=1;
00048 amp=(<a class="code" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d3/dc4/structambermprepinfo.html">ambermprepinfo</a>));
00049 F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>=<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga1">myfreopen</a>(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>,<span class="stringliteral">"r"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// don't depend on calling function to have opened</span>
00050 amp[0].<a class="code" href="../../d3/dc4/structambermprepinfo.html#ambermprepinfoo0">FN</a>=strdup(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00051 fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00052 sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%d %d %d"</span>,&amp;amp[0].IDBGEN,&amp;amp[0].IREST,&amp;amp[0].ITYPF);
00053 fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00054 amp[0].<a class="code" href="../../d3/dc4/structambermprepinfo.html#ambermprepinfoo1">NAMDBF</a>=strdup(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);
00055 M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo31">VP</a>=amp;
00056 
00057 rpuse=malloc_usable_size(M[0].r);
00058 rpsz=<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d7e/structresidue.html">residue</a>);
00059 rpbins=rpuse/rpsz;
00060 <span class="keywordflow">if</span>(rpbins&lt;1){<a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(<span class="stringliteral">"read_prep: no space in residue -- is molecule not initialized?"</span>);}
00061 
00062 <span class="comment">//printf("about to read through the file. Current line is\n\t&gt;&gt;%s&lt;&lt;\n",line);</span>
00063 fgetpos(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>,&amp;f_linestart);<span class="comment">// get current position</span>
00064 <span class="keywordflow">while</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){<span class="comment">// while not end of file</span>
00065 <span class="comment">//printf("\treading a line ...  line is\n&gt;&gt;%s&lt;&lt;\n",line);</span>
00066         stopflag=1;
00067         <span class="keywordflow">for</span>(rpa=0;rpa&lt;strlen(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);rpa++){<span class="comment">// if the first word is not "STOP" (and only that??)</span>
00068                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rpa]!=<span class="charliteral">'\t'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rpa]!=<span class="charliteral">' '</span>)){
00069 <span class="comment">//printf("rpa is %d and line[rpa] is &gt;&gt;%c&lt;&lt; and strlen(line) is %d\n",rpa,line[rpa],strlen(line));</span>
00070                         <span class="keywordflow">if</span>(rpa+4&gt;strlen(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>)){<span class="keywordflow">break</span>;}
00071                         <span class="keywordflow">else</span>{ 
00072                                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rpa]==<span class="charliteral">'S'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rpa+1]==<span class="charliteral">'T'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rpa+2]==<span class="charliteral">'O'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rpa+3]==<span class="charliteral">'P'</span>)){ 
00073                                         stopflag=0;
00074                                         }
00075                                 <span class="keywordflow">break</span>;
00076                                 }
00077                         }
00078                 }
00079 <span class="comment">//printf("stopflag is %d\n",stopflag);</span>
00080         <span class="keywordflow">if</span>(stopflag==0){<span class="keywordflow">break</span>;} <span class="comment">// break loop</span>
00081 <span class="comment">//printf("about to allocate space for the residue...\n");</span>
00082         M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo11">nr</a>++;<span class="comment">// allocate new memory for a residue</span>
00083         M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo12">r</a>=(<a class="code" href="../../d0/d7e/structresidue.html">residue</a>*)realloc(M[0].r,M[0].nr*<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d7e/structresidue.html">residue</a>));
00084         fsetpos(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>,&amp;f_linestart); <span class="comment">// rewind to start of line</span>
00085         M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo12">r</a>[M[0].<a class="code" href="../../dc/d7f/structmolecule.html#moleculeo11">nr</a>-1]=<a class="code" href="../../da/d0c/read__prep_8c.html#a1">read_prepres</a>(F,TYP);<span class="comment">// call read_prepres to read in the residue information</span>
00086         fgetpos(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>,&amp;f_linestart);<span class="comment">// get current position </span>
00087         } <span class="comment">// end while not end of file</span>
00088 <span class="keywordflow">return</span>;
00089 }
00090 
00091 <span class="comment">/******************** read_prepres ****************/</span>
00092 <span class="comment">// START HERE -- add in the void pointer read stuff</span>
00093 <span class="comment">/* this function reads in residue information from a prep file</span>
00094 <span class="comment">        -- currently, it only reads in number, name, type and charge</span>
00095 <span class="comment">        -- connectivity, etc., shall be defined later, though it will</span>
00096 <span class="comment">                read in the information */</span>
<a name="l00097"></a><a class="code" href="../../da/d0c/read__prep_8c.html#a1">00097</a> <a class="code" href="../../d0/d7e/structresidue.html">residue</a> <a class="code" href="../../da/d0c/read__prep_8c.html#a1">read_prepres</a>(<a class="code" href="../../dc/d59/structfileset.html">fileset</a> F, <a class="code" href="../../d5/de2/structtypes.html">types</a> *TYP){ <span class="comment">// will the position be what is expected?</span>
00098 <a class="code" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a> *arp;
00099 <a class="code" href="../../d0/d7e/structresidue.html">residue</a> R;
00100 <span class="keywordtype">char</span> <a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[501],desc[1001],ctmp[51],ctmp2[51]; <span class="comment">// hope no prep file line is longer than this...</span>
00101 <span class="keywordtype">char</span> dumat[21]; <span class="comment">// the symbol used for dummy atoms </span>
00102 <span class="keywordtype">char</span> *linestat; <span class="comment">// did the line read work?</span>
00103 <span class="keywordtype">int</span> itmp=0,rra=0,rline=0;
00104 <span class="keywordtype">char</span> whinetext[1001];
00105 
00106 <span class="comment">// initialize R</span>
00107 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo0">n</a>=0; <span class="comment">// residue number given in input file</span>
00108 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo1">N</a>=strdup(<span class="stringliteral">""</span>); <span class="comment">// reside name -- can live with residue names of 200 chars or less???  :-)</span>
00109 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>=0; <span class="comment">// number of atoms in residue</span>
00110 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo7">m</a>=0; <span class="comment">// molecular weight</span>
00111 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo8">COM</a>=<a class="code" href="../../d3/de6/molecules_8h.html#a60">zero_coord</a>(); <span class="comment">// center of mass for residue</span>
00112 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>=(<a class="code" href="../../da/d81/structatom.html">atom</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../da/d81/structatom.html">atom</a>)); <span class="comment">// atom structures (na of these)</span>
00113 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo11">nbs</a>=0; <span class="comment">// number of bond sets</span>
00114 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo12">bs</a>=(<a class="code" href="../../d6/df4/structbondset.html">bondset</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d6/df4/structbondset.html">bondset</a>)); <span class="comment">// (consecutive bonds, use these for plotting, etc.)</span>
00115 <span class="comment">//int nr; // number of simple rings (no cage structures, etc.)</span>
00116 <span class="comment">//int nrbs; // number of ring bondsets defined</span>
00117 <span class="comment">//bondset *rbs; // bondsets for rings</span>
00118 <span class="comment">//int nrc; // number of ring/reference coordinate sets defined</span>
00119 <span class="comment">//coord_3D *rc; // coordinates for ring/reference centers</span>
00120 <span class="comment">//int nrp; // number of ring planes defined</span>
00121 <span class="comment">//plane *rp; // equations for average/approximate/exact/etc. ring planes (where useful)</span>
00122 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo20">ni</a>=1; <span class="comment">// number of other indices</span>
00123 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo21">i</a>=(<span class="keywordtype">int</span>*)calloc(R.<a class="code" href="../../d0/d7e/structresidue.html#residueo20">ni</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)); <span class="comment">// other indices, as needed (ni of these)</span>
00124 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo22">nd</a>=1; <span class="comment">// number of double-precision parameters</span>
00125 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo23">d</a>=(<span class="keywordtype">double</span>*)calloc(R.<a class="code" href="../../d0/d7e/structresidue.html#residueo22">nd</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">// other parameters, as needed (nd of these)</span>
00126 
00127 <span class="comment">// allocate space for prepinfo</span>
00128 arp=(<a class="code" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../db/d53/structamberrprepinfo.html">amberrprepinfo</a>));
00129 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo11">IOPR</a>=(<a class="code" href="../../d9/db0/structllcharset.html">llcharset</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d9/db0/structllcharset.html">llcharset</a>));
00130 
00131 <span class="comment">// Read residue header information into residue structure</span>
00132 <span class="comment">/* A sample header is:</span>
00133 <span class="comment">0-[ALPHA-D-ALLO-] terminal, RESP 0.010 HF/6-31Gstar//HF/6-31Gstar</span>
00134 <span class="comment">0na.dat</span>
00135 <span class="comment">0NA   INT 0</span>
00136 <span class="comment">CORRECT OMIT DU BEG</span>
00137 <span class="comment"> 0.1940</span>
00138 <span class="comment"></span>
00139 <span class="comment">By line, they are:</span>
00140 <span class="comment">1-2] R.D</span>
00141 <span class="comment">3] R.N, error if not INT (for now), error if not zero (for now)</span>
00142 <span class="comment">4] error if not "CORRECT", ignore, read in dummy atom name, ignore</span>
00143 <span class="comment">5] R.d[0]</span>
00144 <span class="comment">*/</span>
00145 <span class="comment">// first two lines (description)</span>
00146 linestat=fgets(desc,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// first line</span>
00147 <span class="comment">//printf("line 1 looks like: &gt;&gt;%s&lt;&lt;\n",desc);</span>
00148 <span class="keywordflow">if</span>(linestat==NULL){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 1"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00149 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo0">TITLE</a>=strdup(desc); <span class="comment">// add description to arp (destined for void pointer)</span>
00150 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo2">D</a>=strdup(desc); <span class="comment">// copy to residue structure</span>
00151 linestat=fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// second line</span>
00152 <span class="comment">//printf("line 2 looks like: &gt;&gt;%s&lt;&lt;\n",line);</span>
00153 <span class="keywordflow">if</span>(linestat==NULL){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 2"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00154 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo1">NAMF</a>=strdup(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);
00155 <span class="comment">// next line (name and other)</span>
00156 linestat=fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// third line</span>
00157 <span class="keywordflow">if</span>(linestat==NULL){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 3"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00158 sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%s %s %d"</span>,desc,ctmp,&amp;itmp);
00159 <span class="comment">//printf("line 3 looks like: &gt;&gt;%s&lt;&lt;\n",line);</span>
00160 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo1">N</a>=strdup(desc); <span class="comment">// set the residue name</span>
00161 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo2">NAMRES</a>=strdup(desc);
00162 <span class="keywordflow">if</span>(strcmp(ctmp,<span class="stringliteral">"INT"</span>)!=0){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"entry not INT on line 3 of residue header"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00163 <span class="keywordflow">if</span>(itmp!=0){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"KFORM not zero on line 3 of residue header"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00164 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo3">INTX</a>=strdup(ctmp);
00165 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo4">KFORM</a>=itmp;
00166 <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00167 linestat=fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00168 <span class="keywordflow">if</span>(linestat==NULL)<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 4"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00169 sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%s %s %s %s"</span>,desc,ctmp,dumat,ctmp2);
00170 <span class="keywordflow">if</span>(strcmp(desc,<span class="stringliteral">"CORRECT"</span>)!=0){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"entry not CORRECT on line 4 of residue header"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); }
00171 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo5">IFIXC</a>=strdup(desc);
00172 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo6">IOMIT</a>=strdup(ctmp);
00173 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo7">ISYMDU</a>=strdup(dumat);
00174 arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo8">IPOS</a>=strdup(ctmp2);
00175 <span class="comment">// fifth line (charge on residue)</span>
00176 linestat=fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00177 <span class="keywordflow">if</span>(linestat==NULL)<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"EOF during residue header read, line 5 (residue charge)"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00178 sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%lf"</span>,&amp;arp[0].CUT);
00179 <span class="comment">// scan first three dummy atom lines, make sure that the third field</span>
00180 <span class="comment">//      of each is dumat and ignore otherwise (for now, at least)</span>
00181 <span class="keywordflow">for</span>(rra=0;rra&lt;3;rra++){
00182         linestat=fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); <span class="comment">// fourth line (dummy atom symbol &amp; check)</span>
00183         <span class="keywordflow">if</span>(linestat==NULL){
00184                 sprintf(whinetext,<span class="stringliteral">"EOF during residue header read, dummy atom line %d"</span>,(rra+1));
00185                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(whinetext,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); }
00186         sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%s %s %s "</span>,desc,ctmp,ctmp2);
00187         <span class="keywordflow">if</span>(strcmp(ctmp2,dumat)!=0){
00188 <span class="comment">//printf("\t dumat is &gt;&gt;%s&lt;&lt;, and line looks like: &gt;&gt;%s&lt;&lt;\n",dumat,line);</span>
00189                 sprintf(whinetext,<span class="stringliteral">"dummy atom symbol, line %d, does not match declared value"</span>,(rra+1));
00190                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(whinetext,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); }
00191         }
00192 
00193 <span class="keywordflow">while</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){ <span class="comment">// while not end of file</span>
00194         rline=1;
00195 <span class="comment">//printf("line is: %s\n",line);</span>
00196         <span class="keywordflow">for</span>(rra=0;rra&lt;strlen(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);rra++){ <span class="comment">// check for an empty line</span>
00197                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rra]!=<span class="charliteral">'\t'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rra]!=<span class="charliteral">' '</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rra]!=<span class="charliteral">'\n'</span>)){ <span class="comment">// if this character is NOT a space or tab</span>
00198                         rline=0;
00199                         <span class="keywordflow">break</span>; } }
00200         <span class="keywordflow">if</span>(rline==1) <span class="keywordflow">break</span>;<span class="comment">// if an empty line, break loop</span>
00201 <span class="comment">//printf("calling read atom for line: %s\n",line);</span>
00202         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>++;<span class="comment">//       allocate space</span>
00203         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>=(atom*)realloc(R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>,R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>*<span class="keyword">sizeof</span>(atom));
00204         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>[R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>-1]=<a class="code" href="../../da/d0c/read__prep_8c.html#a2">read_prepatom</a>(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,TYP);<span class="comment">//read_prepatom</span>
00205         <span class="comment">// update molecular weight for residue</span>
00206         R.<a class="code" href="../../d0/d7e/structresidue.html#residueo7">m</a>+=TYP[0].<a class="code" href="../../d5/de2/structtypes.html#typeso1">a</a>[R.<a class="code" href="../../d0/d7e/structresidue.html#residueo9">a</a>[R.<a class="code" href="../../d0/d7e/structresidue.html#residueo6">na</a>-1].<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>].<a class="code" href="../../dc/d7a/structatype.html#atypeo3">m</a>;
00207         } <span class="comment">// end read of the residue's atoms</span>
00208 
00209 <span class="comment">// while not "DONE", read any after-atoms residue information</span>
00210 <span class="keywordflow">while</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){ <span class="comment">// while not end of file</span>
00211         rline=1;
00212         <span class="keywordflow">for</span>(rra=0;rra&lt;strlen(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);rra++){ <span class="comment">// check for an empty line</span>
00213                 <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rra]!=<span class="charliteral">'\t'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[rra]!=<span class="charliteral">' '</span>)){ <span class="comment">// if this character is NOT a space or tab</span>
00214                         rline=0;
00215                         <span class="keywordflow">break</span>; } }
00216         <span class="keywordflow">if</span>(rline==1) <span class="keywordflow">continue</span>;<span class="comment">// if an empty line, check next line </span>
00217         <span class="keywordflow">if</span>((<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[0]==<span class="charliteral">'D'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[1]==<span class="charliteral">'O'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[2]==<span class="charliteral">'N'</span>)&amp;&amp;(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[3]==<span class="charliteral">'E'</span>)){<span class="keywordflow">break</span>;}
00218         arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo10">nIOPR</a>++;
00219         arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo11">IOPR</a>=(llcharset*)realloc(arp[0].IOPR,arp[0].nIOPR*<span class="keyword">sizeof</span>(llcharset));
00220         arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo11">IOPR</a>[arp[0].<a class="code" href="../../db/d53/structamberrprepinfo.html#amberrprepinfoo10">nIOPR</a>-1].<a class="code" href="../../d9/db0/structllcharset.html#llcharseto0">T</a>=strdup(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);
00221         } <span class="comment">// end scan of post-atom residue info</span>
00222 
00223 <span class="comment">//printf("Residue %s contains %d atoms\n",R.N,R.na);</span>
00224 <span class="comment">// for future:</span>
00225 <span class="comment">//   scan atom info to set bonding</span>
00226 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo28">nVP</a>=1;
00227 R.<a class="code" href="../../d0/d7e/structresidue.html#residueo29">VP</a>=arp;
00228 
00229 <span class="keywordflow">return</span> R;       
00230 }
00231 
00232 
00233 <span class="comment">/******************* read_prepatom *******************/</span>
00234 
<a name="l00235"></a><a class="code" href="../../da/d0c/read__prep_8c.html#a2">00235</a> <a class="code" href="../../da/d81/structatom.html">atom</a> <a class="code" href="../../da/d0c/read__prep_8c.html#a2">read_prepatom</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <a class="code" href="../../d5/de2/structtypes.html">types</a> *TYP){
00236 <a class="code" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a> *aap;
00237 <a class="code" href="../../da/d81/structatom.html">atom</a> A;
00238 <span class="keywordtype">char</span> N[21],T[21],C[21]; <span class="comment">// if any entry is longer than 21 chars, something is wrong...</span>
00239 <span class="keywordtype">char</span> whinetext[201]; <span class="comment">// error message text</span>
00240 <span class="keywordtype">int</span> raa=0;
00241 
00242 <span class="comment">// Most of this will go into an amberaprepinfo structure.</span>
00243 <span class="comment">// Some bits also go into an atom structure</span>
00244 <span class="comment">// Here is a typical prep-file atom line:</span>
00245 <span class="comment">//      &gt;&gt; 4 C1   CG  M  3  2  1  1.400   113.9      60.0     0.4780&lt;&lt;</span>
00246 <span class="comment">//         1  2   3   4  5  6  7    8      9          10       11</span>
00247 <span class="comment">//      The atom structure bits:</span>
00248 <span class="comment">//      1: A.n</span>
00249 <span class="comment">//      2: A.N=strdup(2)</span>
00250 <span class="comment">//      3: A.T=strdup(3)  --and-- A.t=number for type 3</span>
00251 
00252 aap=(<a class="code" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../df/d84/structamberaprepinfo.html">amberaprepinfo</a>));
00253 
00254 sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%d %s %s %s %d %d %d %lf %lf %lf %lf"</span>,\
00255         &amp;aap[0].I,N,T,C,&amp;aap[0].NA,&amp;aap[0].NB,&amp;aap[0].NC,&amp;aap[0].R,&amp;aap[0].THETA,&amp;aap[0].PHI,&amp;aap[0].CHG);
00256 A.<a class="code" href="../../da/d81/structatom.html#atomo1">N</a>=strdup(N);
00257 aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo1">IGRAPH</a>=strdup(N);
00258 A.<a class="code" href="../../da/d81/structatom.html#atomo2">T</a>=strdup(T);
00259 aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo2">ISYMBL</a>=strdup(T);
00260 aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo3">ITREE</a>=strdup(C);
00261 A.<a class="code" href="../../da/d81/structatom.html#atomo0">n</a>=aap[0].<a class="code" href="../../df/d84/structamberaprepinfo.html#amberaprepinfoo0">I</a>-3; 
00262 <span class="comment">// set the atom's type according to the data in TYP</span>
00263 A.<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>=-1;
00264 <span class="keywordflow">for</span>(raa=0;raa&lt;TYP[0].<a class="code" href="../../d5/de2/structtypes.html#typeso0">na</a>;raa++){
00265 <span class="comment">//printf("TYP[0].a[raa].N is &gt;&gt;%s&lt;&lt; ; A.T is &gt;&gt;%s&lt;&lt;\n",TYP[0].a[raa].N,A.T);</span>
00266         <span class="keywordflow">if</span>(strcmp(TYP[0].a[raa].N,A.<a class="code" href="../../da/d81/structatom.html#atomo2">T</a>)==0){ 
00267                 A.<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>=raa; 
00268                 <span class="keywordflow">break</span>;} }
00269 <span class="keywordflow">if</span>(A.<a class="code" href="../../da/d81/structatom.html#atomo4">t</a>==-1){
00270         sprintf(whinetext,<span class="stringliteral">"read_prepatom:\n\tMatch not found for atom type %s.  The prep file line follows:\n\n%s\n\n"</span>,A.<a class="code" href="../../da/d81/structatom.html#atomo2">T</a>,<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);
00271         <a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(whinetext);
00272         }
00273 <span class="comment">//printf("The entire line is:\n");</span>
00274 <span class="comment">/*printf("%d %s %s %s %d %d %d %f %f %f %f\n",aap[0].I,aap[0].IGRAPH,aap[0].ISYMBL,\</span>
00275 <span class="comment">        aap[0].ITREE,aap[0].NA,aap[0].NB,aap[0].NC,aap[0].R,aap[0].THETA,aap[0].PHI,aap[0].CHG);*/</span>
00276 <span class="comment">//</span>
00277 A.<a class="code" href="../../da/d81/structatom.html#atomo27">nVP</a>=1;
00278 A.<a class="code" href="../../da/d81/structatom.html#atomo28">VP</a>=aap;
00279 
00280 <span class="keywordflow">return</span> A;
00281 }
00282 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Aug 8 10:31:04 2008 for GLYLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
