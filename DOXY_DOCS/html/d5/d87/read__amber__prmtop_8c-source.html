<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GLYLIB: src/read_amber_prmtop.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="../../dir_000002.html">src</a></div>
<h1>read_amber_prmtop.c</h1><a href="../../da/da5/read__amber__prmtop_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* File read_amber_prmtop.c begun on 20080425 by BLFoley</span>
00002 <span class="comment">        Purpose: read amber prmtop file info into an assembly </span>
00003 <span class="comment">        See also: amber_prmtop_structs.h */</span>
00004 <span class="comment">//#include "molecules.h"</span>
00005 <span class="comment">//#include "general.h"</span>
00006 <span class="preprocessor">#include "<a class="code" href="../../d6/d78/amber__prmtop_8h.html">AMBER/amber_prmtop.h</a>"</span>
00007 <span class="comment">//#include "amber_prmtop_structs.h"</span>
00008 <span class="comment">//#include "declarations.h"</span>
00009 <span class="comment">//void read_amber_prmtop_asis(fileset F,amber_prmtop *P);</span>
00010 <span class="comment">// the amber_prmtop *P should be -already- allocated and initialized</span>
00011 
00012 
00013 <span class="comment">/********** assembly *read_amber_prmtop(fileset F) **********/</span>
00014 <span class="comment">/* Main function for reading the prmtop file </span>
00015 <span class="comment"> * the amber_prmtop *P should be -already- allocated and initialized </span>
00016 <span class="comment"> * BUT, it should be otherwise empty  */</span>
<a name="l00017"></a><a class="code" href="../../da/da5/read__amber__prmtop_8c.html#a0">00017</a> <span class="keywordtype">void</span> <a class="code" href="../../da/da5/read__amber__prmtop_8c.html#a0">read_amber_prmtop_asis</a>(<a class="code" href="../../dc/d59/structfileset.html">fileset</a> F,<a class="code" href="../../de/de7/structamber__prmtop.html">amber_prmtop</a> *P){
00018 <span class="keywordtype">int</span> aa=0,anl=0,sec=0,ent=0,fld=0; <span class="comment">// generic, line, section, entry &amp; field counters</span>
00019 <span class="keywordtype">int</span> newflag=0,al=0,newline=0,iseof=1; <span class="comment">// utility flags</span>
00020 <span class="keywordtype">char</span> <a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[501],over[501],tmp[81],*s1,*s2; 
00021 
00022 <span class="comment">// Open files and initialize some variables</span>
00023 <span class="comment">//F.F=myfreopen(F.N,"r",F.F); // don't depend on calling function to have opened</span>
00024 F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>=<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga0">myfopen</a>(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>,<span class="stringliteral">"r"</span>); <span class="comment">// </span>
00025 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo0">FN</a>=strdup(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>); <span class="comment">// the name of the file from which these data were taken</span>
00026 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo2">nS</a>=0; <span class="comment">// the prmtop structure should be empty</span>
00027 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>=(<a class="code" href="../../d6/d75/structamber__prmtop__section.html">amber_prmtop_section</a>*)calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d75/structamber__prmtop__section.html">amber_prmtop_section</a>));
00028 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo3">SN</a>=(<span class="keywordtype">char</span>**)calloc(1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00029 
00030 <span class="comment">//</span>
00031 <span class="comment">// Get the first line, which should be the "VERSION"</span>
00032 <span class="comment">//</span>
00033 <span class="keywordflow">if</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem in read_amber_prmtop"</span>,1,0,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00034 <span class="comment">// See if the first 500 chars includes a newline...</span>
00035 <span class="keywordflow">if</span>(strchr(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="charliteral">'\n'</span>)==NULL){ <span class="comment">// if we didn't get the whole line</span>
00036         fld=500;
00037         fprintf(stderr,<span class="stringliteral">"Unusually long VERSION line.\n"</span>);
00038         fprintf(stderr,<span class="stringliteral">"-- Ignoring characters beyond 500.\n"</span>);
00039         <span class="keywordflow">if</span>(fgets(over,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){<span class="comment">// try to get rest of line</span>
00040                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem in read_amber_prmtop."</span>,1,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00041         <span class="keywordflow">while</span>(strchr(over,<span class="charliteral">'\n'</span>)==NULL){<span class="comment">// try to get rest of line</span>
00042                 fld+=500;
00043                 <span class="keywordflow">if</span>(fgets(over,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){
00044                         <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem in read_amber_prmtop."</span>,1,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00045                 }
00046         } <span class="comment">// close lengthy line check...</span>
00047 <span class="keywordflow">if</span>(strncmp(<span class="stringliteral">"\%VERSION"</span>,<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,8)!=0){
00048         <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"First line not \%VERSION."</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00049 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo1">VERSION</a>=strdup(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>); 
00050 anl=2;
00051 fld=0;
00052 <span class="comment">//</span>
00053 <span class="comment">// grab next line, which should be a flag line</span>
00054 <span class="comment">//</span>
00055 <span class="keywordflow">if</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){ 
00056         <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem in read_amber_prmtop"</span>,anl,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);} 
00057 <span class="comment">// Check the line -- it should be a short-ish FLAG line</span>
00058 <span class="keywordflow">if</span>(strchr(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="charliteral">'\n'</span>)==NULL){<span class="comment">// die if line too long</span>
00059 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"FLAG line over 500 chars... \n"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00060 <span class="comment">//</span>
00061 <span class="comment">// Read the FLAG entry</span>
00062 <span class="comment">//</span>
00063 <span class="keywordflow">if</span>(strncmp(<span class="stringliteral">"\%FLAG"</span>,<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,5)!=0){ <span class="comment">// must start with %FLAG</span>
00064 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Entry not FLAG in read_amber_prmtop"</span>,anl,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00065 <span class="comment">// Parse the FLAG line</span>
00066 <span class="keywordflow">if</span>(sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%s %s"</span>,over,tmp)!=2){<a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(<span class="stringliteral">"Problem in read_amber_prmtop with 1st FLAG read."</span>);}
00067 newflag=0;
00068 <span class="comment">//</span>
00069 <span class="comment">// Start main read of topology file</span>
00070 <span class="comment">// </span>
00071 <span class="keywordflow">while</span>(newflag==0){<span class="comment">// while we have found another flag entry</span>
00072         <span class="comment">// We have a FLAG entry, so increment the number of sections</span>
00073 <span class="comment">//printf("line (FLAG) is &gt;&gt;%s&lt;&lt;\n",line);</span>
00074         sec=P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo2">nS</a>;
00075         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo2">nS</a>++; 
00076         <span class="comment">// Allocate memory </span>
00077         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>=(amber_prmtop_section*)realloc(P[0].S,P[0].nS*<span class="keyword">sizeof</span>(amber_prmtop_section));
00078         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo3">SN</a>=(<span class="keywordtype">char</span>**)realloc(P[0].SN,P[0].nS*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00079         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo3">SN</a>[sec]=strdup(tmp); <span class="comment">// record FLAG entry in</span>
00080         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono0">N</a>=strdup(tmp); <span class="comment">// both locations </span>
00081         <span class="comment">//</span>
00082         <span class="comment">// Read the FORMAT entry</span>
00083         <span class="comment">// </span>
00084         anl++;
00085         <span class="keywordflow">if</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){ <span class="comment">// if we can't read the line, die</span>
00086                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem in read_amber_prmtop."</span>,anl,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00087         <span class="keywordflow">if</span>(strchr(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="charliteral">'\n'</span>)==NULL){ <span class="comment">// FORMAT lines should be short-ish</span>
00088                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"FORMAT line over 500 chars... \n"</span>,anl,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00089         <span class="keywordflow">if</span>(strncmp(<span class="stringliteral">"\%FORMAT"</span>,<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,7)!=0){<span class="comment">// must start with %FORMAT</span>
00090                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Entry not FORMAT in read_amber_prmtop"</span>,anl,fld,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);} 
00091 <span class="comment">//printf("line (FORMAT) is &gt;&gt;%s&lt;&lt;\n",line); </span>
00092         <span class="comment">// split line by parentheses as tokens</span>
00093         s1=strdup(strtok(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"()"</span>));<span class="comment">// toss out the "%FORMAT" part</span>
00094         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono1">FORMAT</a>=strdup(strtok(NULL,<span class="stringliteral">"()"</span>)); <span class="comment">// save next</span>
00095         s1=strdup(P[0].S[sec].FORMAT); <span class="comment">// save a char string to tear apart</span>
00096         <span class="comment">// parse the format string</span>
00097         s2=strdup(strtok(s1,<span class="stringliteral">"aAiIfFeE"</span>)); <span class="comment">// up to the format identifier</span>
00098         sscanf(s2,<span class="stringliteral">"%d"</span>,&amp;P[0].S[sec].npl); <span class="comment">// max entries expected per line</span>
00099         s2=strdup(strtok(NULL,<span class="stringliteral">"."</span>)); <span class="comment">// up to any periods</span>
00100         <span class="keywordflow">if</span>((strchr(s2,<span class="charliteral">'S'</span>)!=NULL)||(strchr(s2,<span class="charliteral">'N'</span>)!=NULL)){over[0]=<span class="charliteral">'0'</span>;} <span class="comment">// EN or ES</span>
00101         sscanf(s2,<span class="stringliteral">"%d"</span>,&amp;P[0].S[sec].nc); <span class="comment">// number of chars in format </span>
00102 <span class="comment">//printf("parsed format:  npl is %d ; nc is %d \n",P[0].S[sec].npl,P[0].S[sec].nc);</span>
00103         <span class="comment">//</span>
00104         <span class="comment">// Read the section</span>
00105         <span class="comment">// </span>
00106         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)calloc(1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)); <span class="comment">// initially allocate **D</span>
00107         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>=0; <span class="comment">// total pieces of data found </span>
00108         ent=0;
00109         <span class="keywordflow">while</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,6,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)!=NULL){
00110 <span class="comment">//printf("the fgets's line is &gt;&gt;%s&lt;&lt;\n",line);</span>
00111 <span class="comment">//printf("in ascii decimal: %d %d %d %d %d %d\n",line[0],line[1],line[2],line[3],line[4],line[5]);</span>
00112                 <span class="keywordflow">if</span>(strcspn(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\0"</span>)==0){
00113 <span class="comment">//printf("found empty line\n");</span>
00114                         <span class="keywordflow">continue</span>;
00115                         }
00116                 <span class="comment">//ae=fgetc(F.F);</span>
00117 <span class="comment">//printf("ae is &gt;&gt;%c&lt;&lt;\n",ae);</span>
00118                 <span class="comment">//if(ae==EOF){</span>
00119 <span class="comment">//printf("Found end of file, stopping.\n");</span>
00120                         <span class="comment">//break;}</span>
00121                 <span class="comment">//else{ungetc(ae,F.F);}</span>
00122                 anl++; <span class="comment">// we have a new line</span>
00123                 fld=0; <span class="comment">// start field count over</span>
00124                 <span class="comment">// check to see if first 5 chars match "%FLAG"</span>
00125                 <span class="keywordflow">if</span>(strncmp(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\%FLAG"</span>,5)==0){ 
00126 <span class="comment">//printf("found a FLAG line\n");</span>
00127                         <span class="keywordflow">break</span>;} <span class="comment">// if so, stop this</span>
00128                 <span class="keywordflow">if</span>(strcspn(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\0"</span>)==0){
00129                         <span class="keywordflow">continue</span>;
00130                         }
00131                 <span class="keywordflow">if</span>(strcspn(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\n"</span>)==0){
00132                         fprintf(stderr,<span class="stringliteral">"Unexpected blank line in read_amber_prmtop\n"</span>);
00133                         fprintf(stderr,<span class="stringliteral">"   at line number %d in file %s.  Ignoring.\n"</span>,anl,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);
00134                         fprintf(stderr,<span class="stringliteral">"The section (%d) FLAG is:  %s\n"</span>,sec,P[0].SN[sec]);
00135                         <span class="keywordflow">continue</span>;
00136                         }
00137 <span class="comment">// </span>
00138 <span class="comment">// Since the "flag check" field length might not be five...</span>
00139 <span class="comment">//</span>
00140 <span class="keywordflow">if</span>(P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono5">nc</a>&lt;5){ <span class="comment">// the flag read contains more than one entry</span>
00141         <span class="comment">// find out how much memory we need</span>
00142 <span class="comment">//printf("P[0].S[sec].nc&lt;5\n");</span>
00143         <span class="comment">// copy extra bits to the new strings</span>
00144         <span class="comment">// being long here because it's easier to write...</span>
00145         ent=P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>;
00146         <span class="keywordflow">switch</span>(P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono5">nc</a>){
00147                 <span class="keywordflow">case</span> 0:
00148                         <a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(<span class="stringliteral">"format character length reports as zero in read_amber_prmtop\n"</span>);
00149                         <span class="keywordflow">break</span>;
00150                 <span class="keywordflow">case</span> 1:
00151                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>+=5;
00152                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00153                         al=0;
00154                         <span class="keywordflow">for</span>(aa=0;aa&lt;5;aa++){
00155                                 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(2,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00156                                 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[al];
00157                                 P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][1]=<span class="charliteral">'\0'</span>;
00158 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00159                                 al++;
00160                                 ent++;
00161                                 }
00162                         <span class="keywordflow">break</span>;
00163                 <span class="keywordflow">case</span> 2:
00164                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>+=3;
00165                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00166                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(3,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00167                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[0];
00168                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][1]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[1];
00169                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][2]=<span class="charliteral">'\0'</span>;
00170 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00171                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1]=(<span class="keywordtype">char</span>*)calloc(3,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00172                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[2];
00173                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][1]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[3];
00174                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][2]=<span class="charliteral">'\0'</span>;
00175 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent+1,P[0].S[sec].D[ent+1]);</span>
00176                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+2]=(<span class="keywordtype">char</span>*)calloc(3,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00177                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+2][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[4];
00178                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+2][1]=fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00179                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+2][2]=<span class="charliteral">'\0'</span>;
00180 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent+2,P[0].S[sec].D[ent+1]);</span>
00181                         ent+=3;
00182                         <span class="keywordflow">break</span>;
00183                 <span class="keywordflow">case</span> 3:
00184                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>+=2;
00185                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00186                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(4,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00187                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[0];
00188                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][1]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[1];
00189                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][2]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[2];
00190                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][3]=<span class="charliteral">'\0'</span>;
00191 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00192                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1]=(<span class="keywordtype">char</span>*)calloc(4,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00193                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[3];
00194                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][1]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[4];
00195                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][2]=fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00196                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][3]=<span class="charliteral">'\0'</span>;
00197 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent+1,P[0].S[sec].D[ent+1]);</span>
00198                         ent+=2;
00199                         <span class="keywordflow">break</span>;
00200                 <span class="keywordflow">case</span> 4:
00201                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>+=2;
00202                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00203                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(5,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00204                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[0];
00205                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][1]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[1];
00206                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][2]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[2];
00207                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][3]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[3];
00208                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][4]=<span class="charliteral">'\0'</span>;
00209 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00210                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1]=(<span class="keywordtype">char</span>*)calloc(5,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00211                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][0]=<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[4];
00212                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][1]=fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00213                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][2]=fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00214                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent+1][3]=fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00215                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent][4]=<span class="charliteral">'\0'</span>;
00216 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent+1,P[0].S[sec].D[ent+1]);</span>
00217                         ent+=2;
00218                         <span class="keywordflow">break</span>;
00219                 <span class="keywordflow">default</span>:
00220                         <a class="code" href="../../d9/d66/mywhine_8c.html#a0">mywhine</a>(<span class="stringliteral">"nc should be less than five in read_amber_prmtop, but seems like more than five...\n"</span>);
00221                 }
00222         }
00223 <span class="keywordflow">if</span>(P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono5">nc</a>==5){ <span class="comment">// the read contains exactly one entry</span>
00224 <span class="comment">//printf("P[0].S[sec].nc==5\n");</span>
00225         ent=P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>; <span class="comment">// for convenience</span>
00226         <span class="comment">// allocate space for the next entry</span>
00227         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>++;
00228         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00229         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(6,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00230         strncpy(P[0].S[sec].D[ent],<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,6);
00231 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00232         }
00233 <span class="keywordflow">if</span>(P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono5">nc</a>&gt;5){ <span class="comment">// the flag read contains less than one entry</span>
00234 <span class="comment">//printf("P[0].S[sec].nc&gt;5\n"); </span>
00235         ent=P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>; <span class="comment">// for convenience</span>
00236         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>++; <span class="comment">// we will only need one more character space</span>
00237         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00238 <span class="comment">//printf("line is &gt;&gt;&gt;%s&lt;&lt;&lt;\n",line);</span>
00239         <span class="comment">// fill out the "line" string to the proper length</span>
00240         <span class="keywordflow">for</span>(aa=5;aa&lt;(P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono5">nc</a>);aa++){ 
00241                 <a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[aa]=fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>); 
00242 <span class="comment">//printf("the new character is &gt;&gt;&gt;%c&lt;&lt;&lt;\n",line[aa]);</span>
00243                 }
00244         <a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[aa]=<span class="charliteral">'\0'</span>; <span class="comment">// terminate the string </span>
00245 <span class="comment">//printf("line is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",line);</span>
00246         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(P[0].S[sec].nc+1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00247         strncpy(P[0].S[sec].D[ent],<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,P[0].S[sec].nc+1);
00248 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00249         }
00250 <span class="comment">// </span>
00251 <span class="comment">// Now read the rest of the line...</span>
00252 <span class="comment">// </span>
00253 <span class="comment">//printf("reading the rest of the line.\n");</span>
00254 newline=1;
00255 <span class="keywordflow">while</span>(newline!=0){
00256         <span class="keywordflow">if</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,(P[0].S[sec].nc+1),F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){
00257                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"problem in read_amber_prmtop"</span>,anl,ent,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00258 <span class="comment">//printf("the line is &gt;&gt;&gt;%s&lt;&lt;&lt;\n",line);</span>
00259 <span class="comment">//printf("in ascii decimal: ");</span>
00260 <span class="comment">//for(ae=0;ae&lt;P[0].S[sec].nc+1;ae++){printf(" %d ",line[ae]);}</span>
00261 <span class="comment">//printf("\n");</span>
00262                 <span class="keywordflow">if</span>(strcspn(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\0"</span>)==0){
00263 <span class="comment">//printf("found empty string\n");</span>
00264                         newline=0;
00265                         <span class="keywordflow">break</span>;
00266                         }
00267         <span class="keywordflow">if</span>(strcspn(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\n"</span>)==0){ <span class="comment">// at end of line, no new data</span>
00268                 newline=0;
00269                 <span class="keywordflow">break</span>;}
00270         <span class="keywordflow">if</span>(strchr(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="charliteral">'\n'</span>)!=NULL){ <span class="comment">// this is the end of a line, but with data </span>
00271                 <span class="keywordflow">for</span>(aa=0;aa&lt;strlen(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>);aa++){ <span class="comment">//check for all whitespace</span>
00272                         <span class="keywordflow">if</span>(isspace(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[aa])==0) newline=-1; <span class="comment">// something isn't white</span>
00273                         }
00274                 <span class="keywordflow">if</span>(newline==-1){
00275                         <a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>[strcspn(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"\n"</span>)]=<span class="charliteral">'\0'</span>; 
00276                         ent=P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>; <span class="comment">// for convenience</span>
00277                         <span class="comment">// allocate space for the next entry</span>
00278                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>++;
00279                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00280                         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(P[0].S[sec].nc+1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00281                         strncpy(P[0].S[sec].D[ent],<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,P[0].S[sec].nc+1);
00282 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00283                         }
00284                 newline=0;
00285                 <span class="keywordflow">break</span>;
00286                 }
00287         ent=P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>; <span class="comment">// for convenience</span>
00288         <span class="comment">// allocate space for the next entry</span>
00289         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono7">nt</a>++;
00290         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>=(<span class="keywordtype">char</span>**)realloc(P[0].S[sec].D,P[0].S[sec].nt*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00291         P[0].<a class="code" href="../../de/de7/structamber__prmtop.html#amber__prmtopo4">S</a>[sec].<a class="code" href="../../d6/d75/structamber__prmtop__section.html#amber__prmtop__sectiono10">D</a>[ent]=(<span class="keywordtype">char</span>*)calloc(P[0].S[sec].nc+1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00292         strncpy(P[0].S[sec].D[ent],<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,P[0].S[sec].nc+1); 
00293 <span class="comment">//printf("the entry for P[0].S[%d].D[%d] is -now- &gt;&gt;&gt;%s&lt;&lt;&lt;\n",sec,ent,P[0].S[sec].D[ent]);</span>
00294         }<span class="comment">// close while not a new line</span>
00295         }<span class="comment">// close fgets within a section </span>
00296 
00297         <span class="keywordflow">if</span>(newflag==-1){<span class="keywordflow">break</span>;}
00298         <span class="keywordflow">if</span>(fgets(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,500,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==NULL){ 
00299                 <span class="keywordflow">if</span>(fgetc(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>)==EOF){
00300                         iseof=1;
00301                         newflag=-1;
00302                         <span class="keywordflow">break</span>;}
00303                 <span class="keywordflow">else</span>{<a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem in FLAG line read read_amber_prmtop"</span>,anl,0,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00304                 } 
00305         <span class="keywordflow">if</span>(newflag==-1){<span class="keywordflow">break</span>;}
00306         <span class="comment">// If here, then we found a FLAG, read it in, exit loop and start new</span>
00307         <span class="comment">// Check the line -- it should be a short-ish FLAG line</span>
00308         <span class="keywordflow">if</span>(strchr(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="charliteral">'\n'</span>)==NULL){<span class="comment">// die if line too long</span>
00309         <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga2">read_eek</a>(<span class="stringliteral">"FLAG line over 500 chars... \n"</span>,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00310         <span class="comment">//</span>
00311         <span class="comment">// Read the FLAG entry</span>
00312         <span class="comment">//</span>
00313         <span class="comment">// Parse the FLAG line</span>
00314         <span class="keywordflow">if</span>(sscanf(<a class="code" href="../../d7/d40/load__pdb_8h.html#a5">line</a>,<span class="stringliteral">"%s"</span>,tmp)!=1){
00315                 <a class="code" href="../../df/da0/group__FILE__UTILS.html#ga4">read_fneek</a>(<span class="stringliteral">"Problem FLAG entry scan, read_amber_prmtop."</span>,anl,1,F.<a class="code" href="../../dc/d59/structfileset.html#fileseto0">N</a>);}
00316         } <span class="comment">// close fgets for reading file</span>
00317 
00318 fclose(F.<a class="code" href="../../dc/d59/structfileset.html#fileseto1">F</a>);
00319 
00320 <span class="comment">/*F.F=myfopen("test_rewrite_of_prmtop","w");</span>
00321 <span class="comment">fprintf(F.F,"%s",P[0].VERSION);</span>
00322 <span class="comment">for(sec=0;sec&lt;P[0].nS;sec++){ // for each section found</span>
00323 <span class="comment">        fprintf(F.F,"%%FLAG %s\n",P[0].S[sec].N);</span>
00324 <span class="comment">        fprintf(F.F,"%%FORMAT(%s)\n",P[0].S[sec].FORMAT);</span>
00325 <span class="comment">        for(aa=0;aa&lt;P[0].S[sec].nt;aa++){</span>
00326 <span class="comment">                fprintf(F.F,"%s",P[0].S[sec].D[aa]);</span>
00327 <span class="comment">                //fprintf(F.F,"D[%d] is &gt;&gt;&gt;%s&lt;&lt;&lt;\n",aa,P[0].S[sec].D[aa]);</span>
00328 <span class="comment">                fflush(F.F);</span>
00329 <span class="comment">//printf("\naa is %d ; P[0].S[%d].npl is %d ; (aa+1)%%npl is %d\n",aa,sec,P[0].S[sec].npl,);</span>
00330 <span class="comment">                if((((aa+1)%P[0].S[sec].npl))==0){fprintf(F.F,"\n");} </span>
00331 <span class="comment">                //if((((aa+1)*P[0].S[sec].nc))%80==0){printf("\n");} </span>
00332 <span class="comment">                }</span>
00333 <span class="comment">        if(((aa)*P[0].S[sec].nc)%80!=0){fprintf(F.F,"\n");} </span>
00334 <span class="comment">        }</span>
00335 <span class="comment">fclose(F.F);</span>
00336 <span class="comment">*/</span>
00337 
00338 <span class="keywordflow">return</span>;
00339 } 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jul 22 12:10:51 2008 for GLYLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
